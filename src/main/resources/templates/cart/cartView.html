<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>장바구니</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-white">
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="/">🛍️ LocalShop</a>
        <div class="d-flex ms-auto">
            <div th:if="${session.loginUser == null}">
                <a href="/login" class="btn btn-outline-primary me-2">로그인</a>
                <a href="/signup" class="btn btn-primary">회원가입</a>
            </div>
            <div th:if="${session.loginUser != null}">
                <span class="me-3 align-self-center" th:text="'👤 ' + ${session.loginUser.name} + '님'"></span>
                <a href="/cart" class="btn btn-outline-success me-2">장바구니</a>
                <a href="/orders/history" class="btn btn-outline-secondary me-2">결제내역</a>
                <a href="/logout" class="btn btn-outline-danger">로그아웃</a>
            </div>
        </div>
    </div>
</nav>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">🛒 장바구니</h2>
        <a href="/" class="btn btn-outline-primary">홈으로</a>
    </div>

    <table class="table table-bordered text-center align-middle">
        <thead class="table-light">
        <tr>
            <th>상품</th>
            <th>수량</th>
            <th>단가</th>
            <th>합계</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${cart}">
            <td class="d-flex align-items-center">
                <img th:src="${item.imagePath}" class="me-2" style="width: 50px; height: 50px; object-fit: cover;">
                <a th:href="@{/products/{id}(id=${item.productId})}" th:text="${item.name}">상품명</a>
            </td>
            <td th:text="${item.quantity}"></td>
            <td th:text="${item.price}"></td>
            <td th:text="${item.totalPrice}"></td>
            <td>
                <form th:action="@{/cart/remove}" method="post">
                    <input type="hidden" name="productId" th:value="${item.productId}" />
                    <button type="submit" class="btn btn-sm btn-danger">삭제</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="d-flex justify-content-between mt-4">
        <form th:action="@{/cart/clear}" method="post">
            <button type="submit" class="btn btn-outline-secondary">전체 비우기</button>
        </form>
        <form th:action="@{/orders/new}" method="get">
            <button type="submit" class="btn btn-primary">주문하기</button>
        </form>
    </div>
</div>
</body>
</html>